//tealium universal tag - utag.491 ut4.0.202502110702, Copyright 2025 Tealium.com Inc. All Rights Reserved.
try{(function(id,loader){var u={};utag.o[loader].sender[id]=u;if(utag===undefined){utag={};}if(utag.ut===undefined){utag.ut={};}if(utag.ut.loader===undefined){u.loader=function(o){var a,b,c,l;a=document;if(o.type==="iframe"){b=a.createElement("iframe");b.setAttribute("height","1");b.setAttribute("width","1");b.setAttribute("style","display:none");b.setAttribute("src",o.src);}else if(o.type==="img"){utag.DB("Attach img: "+o.src);b=new Image();b.src=o.src;return;}else{b=a.createElement("script");b.language="javascript";b.type="text/javascript";b.async=1;b.charset="utf-8";b.src=o.src;}if(o.id){b.id=o.id;}if(typeof o.cb==="function"){if(b.addEventListener){b.addEventListener("load",function(){o.cb();},false);}else{b.onreadystatechange=function(){if(this.readyState==="complete"||this.readyState==="loaded"){this.onreadystatechange=null;o.cb();}};}}l=o.loc||"head";c=a.getElementsByTagName(l)[0];if(c){utag.DB("Attach to "+l+": "+o.src);if(l==="script"){c.parentNode.insertBefore(b,c);}else{c.appendChild(b);}}};}else{u.loader=utag.ut.loader;}
u.ev={'view':1,"link":1};u.map={"touchpoint":"event.string.touchpoint,attr.touchpoint","selected_market":"event.string.market,attr.market","display_language":"event.string.locale,attr.locale","page_full_path":"event.string.page","dom.pathname":"event.string.url","ut.env":"cfg.env,attr.env","ut.version":"attr.codeVersion,event.string.codeVersion","dep_sid_cookie":"cfg.sId","corporate_brand_id":"cfg.brandId,attr.brandId","customer_consent_groups":"cfg.consent,attr.consent","dep_events":"events","dep_variable_name":"dynamic_name","dep_variable_format":"dynamic_format","user_agent":"event.string.user_agent","customer_city_hash":"user.string.hashed_city","customer_zip_hash":"user.string.hashed_zip","customer_country_hash":"user.string.hashed_country","customer_status_bool":"event.bool.loggedIn","customer_isp":"event.string.isp","customer_geo_country_code":"event.string.geoCountryCode","customer_geo_country_name":"event.string.geoCountryName","_sm_491_22":"event.bool.returnUser","dep_sid_cookie_logic":"event.string.sIdCLogic","page_path":"event.string.pagePath","page_name":"event.string.pageName","page_type":"event.string.pageType","unique_event_id":"event.string.unique_event_id","customer_email_hash":"user.string.hashed_email","_sm_491_29":"event.integer.eventCount"};u.extend=[function(a,b){try{b['_sm_491_22']=(b["cp.utag_main__sn"]==="1")?false:true;;}catch(e){utag.DB(e);}
try{b['_sm_491_29']=Number(b["cp.utag_main__se"]);}catch(e){utag.DB(e);}},function(a,b){try{if(1){u.data.case_vars=["url","hmId","capi_test_id"];}}catch(e){utag.DB(e)}}];u.send=function(a,b){if(u.ev[a]||u.ev.all!==undefined){var d,e,f,i;u.data={host:"https://dep.hmgroup.com",uri:"/v1/",code_version:b["ut.version"],events:b.dep_events};for(c=0;c<u.extend.length;c++){try{d=u.extend[c](a,b);if(d==false)return}catch(e){}};for(d in utag.loader.GV(u.map)){if(b[d]!==undefined&&b[d]!==""){e=u.map[d].split(",");for(f=0;f<e.length;f++){u.data[e[f]]=b[d];}}}
function popCurrency(){let f="";if(b._ccurrency){f=b._ccurrency;}else if(tiq.pageData.currency!==""&&tiq.pageData.currency!==undefined){f=tiq.pageData.currency;}
if(f.length!==3){return"";}
f=payloadCase("currency",f);return f;}
function popEcom(en,currency){let f={},value=0;if(currency!==""){f.currency=currency;if(tiq.tools.variable_is(b._cprice)){let d=0;for(let i=0;i<b._cprod.length;i++){d+=(tiq.tools.variable_is(b._cquan[i]))?Number(b._cprice[i])*Number(b._cquan[i]):Number(b._cprice[i]);}
value=d;f.value=Math.round(value*100)/100;}}
if(en==="purchase"){f.transaction_id=b._corder;let shipping=Number(b._cship);f.shipping=shipping;let coupon=(b._cpromo)?b._cpromo:undefined;f.coupon=coupon;value=Number(b._csubtotal);f.value=Math.round(value*100)/100;f.paymentType=b._cpayment;f.deliveryType=b._cdelivery;}else if(en==="return_confirmation"){f.transaction_id=b.order_return_id;value=Number(b.order_returned_value);f.value=Math.round(value*100)/100;}else if(en==="order_cancelled"){f.transaction_id=b.order_cancel_id;let shipping=Number(b._cship);f.shipping=shipping;value=Number(b._csubtotal);f.value=Math.round(value*100)/100;}
return f;}
function popProduct(currency){let c=[];for(let i=0;i<b._cprod.length;i++){let e={};e.id=(b._cprod&&tiq.tools.variable_is(b._cprod[i]))?b._cprod[i]:undefined;e.name=(b._cprodname&&tiq.tools.variable_is(b._cprodname[i]))?b._cprodname[i].toLowerCase():undefined;e.brand=(b._cbrand&&tiq.tools.variable_is(b._cbrand[i]))?b._cbrand[i].toLowerCase():undefined;e.variant=(b._csku&&tiq.tools.variable_is(b._csku[i]))?b._csku[i]:undefined;e.category=(b._ccat&&tiq.tools.variable_is(b._ccat[i]))?b._ccat[i].toLowerCase():undefined;e.size=(b._csize&&tiq.tools.variable_is(b._csize[i]))?b._csize[i].toLowerCase():undefined;e.sizeCode=(b._csizecode&&tiq.tools.variable_is(b._csizecode[i]))?b._csizecode[i]:undefined;if(currency&&tiq.tools.variable_is(currency)){e.price=0;e.price=(b._cprice&&tiq.tools.variable_is(b._cprice[i]))?Math.round(Number(b._cprice[i])*100)/100:undefined;e.whitePrice=(b._cwhiteprice&&tiq.tools.variable_is(b._cwhiteprice[i]))?Math.round(Number(b._cwhiteprice[i])*100)/100:undefined;e.priceType=(b._cpricetype&&tiq.tools.variable_is(b._cpricetype[i]))?b._cpricetype[i]:undefined;}
e.quantity=(b._cquan&&tiq.tools.variable_is(b._cquan[i]))?Number(b._cquan[i]):undefined;if(en==="product_list_click"){e.listName=(b.listName&&tiq.tools.variable_is(b.listName[i]))?b.listName[i].toLowerCase():undefined;e.listPosition=(b.listPosition&&tiq.tools.variable_is(b.listPosition[i]))?""+b.listPosition[i]:undefined;e.listSource=(b.listSource&&tiq.tools.variable_is(b.listSource[i]))?b.listSource[i]:undefined;}
e.hasVideo=(b.product_video&&tiq.tools.variable_is(b.product_video[0])&&(b.product_video[0]==="true"||b.product_video[0]==="TRUE"))?true:false;c.push(e);}
return c;}
function popItem(en,ep){let c=[];let e={};if(en==="product_list_view"){for(let i=0;i<ep.length;i++){let e={};e.id=(typeof ep[i].id==="string")?ep[i].id:ep[i].id[0];e.name=(ep[i].name!=="")?ep[i].name.toLowerCase():undefined;e.brand=(ep[i].brand!=="")?ep[i].brand.toLowerCase():undefined;e.variant=(b._csku&&tiq.tools.variable_is(b._csku[i]))?b._csku[i]:undefined;e.category=(ep[i].category!=="")?ep[i].category.toLowerCase():undefined;e.size=(b._csize&&tiq.tools.variable_is(b._csize[i]))?b._csize[i].toLowerCase():undefined;e.sizeCode=(b._csizecode&&tiq.tools.variable_is(b._csizecode[i]))?b._csizecode[i]:undefined;if(en==="product_list_view"){e.listName=(ep[i].listName&&tiq.tools.variable_is(ep[i].listName))?ep[i].listName.toLowerCase():undefined;e.listPosition=(ep[i].listPosition&&tiq.tools.variable_is(ep[i].listPosition))?""+ep[i].listPosition:undefined;e.listSource=(ep[i].listSource&&tiq.tools.variable_is(ep[i].listSource))?ep[i].listSource:undefined;}
e.hasVideo=(ep[i].hasVideo!=="")?ep[i].hasVideo:false;c.push(e);}}else{if(ep.id===""){return undefined;}else{e.id=(typeof ep.id==="string")?ep.id:ep.id[0];e.name=(ep.name!=="")?ep.name.toLowerCase():undefined;e.brand=(ep.brand!=="")?ep.brand.toLowerCase():undefined;e.category=(ep.category!=="")?ep.category.toLowerCase():undefined;e.size=(tiq.tools.variable_is(ep.size))?ep.size.toLowerCase():undefined;if(tiq.tools.variable_is(ep.sizeCode)){e.sizeCode=ep.sizeCode;e.variant=ep.id+ep.sizeCode;}
c.push(e);}}
return c;}
function payloadCase(b,c){let d=0;for(let i=0;i<u.data.case_vars.length;i++){if(b===u.data.case_vars[i]){d=1;}}
if(d===1){return c;}else{if(typeof(c)==="string"){c=c.toString().toLowerCase();}}
return c;}
function popConfig(en,et){let c={eventName:en.toLowerCase(),eventType:et.toLowerCase()};let eventString=c.eventName.replace(/ /g,"");for(let d in u.data){if(d.indexOf('cfg.')>-1){let e=d.split(".");c[e[1]]=payloadCase(e[1],u.data[d]);}}
return c;}
function popPayload(ep){let c=[];for(let d in u.data){let f={};if(d.indexOf('event.')>-1){let e=d.split(".");f.name=e[2];if(Array.isArray(u.data[d])){u.data[d]=u.data[d][0];}
f[e[1]+"Value"]=payloadCase(e[2],u.data[d]);c.push(f);}}
for(let i=0;i<ep.length;i++){let f={};if(tiq.tools.variable_is(ep[i].name)){if(ep[i].name==="unique_event_id"){for(let j=0;j<c.length;j++){if(c[j].name==="unique_event_id"){c[j].stringValue=ep[i].value;j=c.length;}}}else if(ep[i].name!=="item"){f.name=ep[i].name;f[ep[i].type+"Value"]=payloadCase(ep[i].name,ep[i].value);c.push(f);}}}
if(tiq.tools.variable_is(u.data.dynamic_name)&&u.data.dynamic_name.length>0){let existing_parameters=c.map(function(x){return x.name;});const dynamic_name=window.tiq.tools.array_maker(u.data.dynamic_name,",")
const dynamic_format=window.tiq.tools.array_maker(u.data.dynamic_format,",")
for(let i=0;i<dynamic_name.length;i++){if(existing_parameters.includes(dynamic_name[i])){continue;}
let k=dynamic_name[i];let h=dynamic_format[i].toLowerCase();if(tiq.tools.variable_is(k)){var f={};f.name=k;if(tiq.tools.variable_is(b[k])){let e=b[k];if(h==='string'){if(typeof e!=='string'){e=""+e;}
e=encodeURI(e).replace(/%20/g,' ');}
if(h==='integer'){if(typeof e!=='number'||!Number.isInteger(e)){e=parseInt(e);}
if(isNaN(e)){e='value and format ('+h+') mismatch';h='string';}}
if(h==='float'){if(typeof e!=='number'){e=parseFloat(e);}
if(isNaN(e)){e='value and format ('+h+') mismatch';h='string';}}
if(h==='boolean'||h==='bool'){h='bool';if(typeof e!=='boolean'){if(e==='true'||e==='TRUE'||e==='True'||e==='1'||e===1||e==="yes"||e==="YES"||e==="Yes"){e=true;}else if(e==='false'||e==='FALSE'||e==='False'||e==='0'||e===0||e==="no"||e==="NO"||e==="No"){e=false;}else{e='value and format ('+h+') mismatch';h='string';}}}
f[h+"Value"]=payloadCase(k,e);c.push(f);}else{f["stringValue"]='undefined';c.push(f);}}}}
return c;}
function popUserData(){let c={};for(let d in u.data){if(d.indexOf('user.')>-1){let e=d.split(".");c[e[2]]=payloadCase(e[2],u.data[d]);}}
return c;}
function popAttributes(ea){let c=[];ea.forEach(function(param){c.push(param);});for(d in u.data){if(d.indexOf('attr.')>-1){let f=u.data[d],e=d.split(".")[1];if(Array.isArray(f)){f=f[0];}
if(e==="brandId"||e==="locale"||e==="market"||e==="touchpoint"){f=e+"_"+u.data[d];}
if(e==="consent"){let g=u.data[d];for(let h in g){if(g[h]===true){f=e+"_"+h;c.push(f);}}
continue;}
c.push(f);}}
for(let i=0;i<c.length;i++){c[i]=c[i].toLowerCase();}
return c;}
u.te=function(d,ep){a.script_version="1.1";var b=JSON.stringify(ep);if(navigator.sendBeacon){navigator.sendBeacon(d,b);}else{var c=new XMLHttpRequest();c.open("POST",d);c.setRequestHeader("Content-Type","text/plain");c.send(b);}};try{if(u.data.events.length===0){return;}else{for(let i=0;i<u.data.events.length;i++){if(u.data.events[i].test){continue;}
var et=u.data.events[i].type;var en=u.data.events[i].name;var payload={};payload.parameters=popPayload(u.data.events[i].parameters);payload.dataAttributes=popAttributes(u.data.events[i].attributes);if(et==="item"){try{var ep=u.data.events[i].parameters;for(let j=0;j<ep.length;j++){if(ep[j].name==="item"){payload.items=popItem(en,ep[j].value);}}}catch(e){}}
if(et==="ecommerce"){try{payload.ecom=popEcom(en,popCurrency());payload.items=popProduct(payload.ecom.currency);if(u.data.events[i].name==="purchase"){payload.userData=popUserData();}}catch(e){}}
var cfg=popConfig(en,et);utag.ut.merge(payload,cfg,0);if(en!==null){if(b["ut.env"]==="qa"){u.data.host="https://collector-llmguu4m5a-ew.a.run.app";}else if(b["ut.env"]==="dev"){u.data.host="https://collector-n3keh4osvq-ew.a.run.app";}
var endpoint=u.data.host+u.data.uri;u.te(endpoint,payload);}}}}catch(e){}
}};utag.o[loader].loader.LOAD(id);})("491","hm.goe");}catch(error){utag.DB(error);}
